<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>JSON Schema validation demo</title>
    <link href="style.css" rel="stylesheet" type="text/css">
    <script src="jquery-1.9.0.min.js" type="text/javascript"></script>
    <script type="text/javascript">

        // My first ever JavaScript code! Yay!

        // Some constants
        var Servlets = { VALIDATE: "validate" };
        var DomElements = {
            FORM: "#validate",
            RESULTS: "textarea#results"
        };

        var f = function()
        {
            // References to what we need
            var $form = $(DomElements.FORM);
            var $resultOutput = $(DomElements.RESULTS);

            $form.submit(function (event)
            {
                // Grab fields in the form
                // TODO: Complete list when necessary
                var $inputs = $form.find("textarea, :checkbox, input");

                // Serialize all of the form -- _very_ convenient, that!
                var payload = $form.serialize();

                // Lock inputs
                $inputs.prop("disabled", true);

                // The request
                var request = $.ajax({
                    // FIXME: hardcoded :/
                    url: Servlets.VALIDATE,
                    type: "post",
                    data: payload,
                    dataType: "text"
                });

                // On success
                request.done(function (response, status, xhr)
                {
                    $resultOutput.val(response);
                });

                // On failure
                request.fail(function (xhr, status, error)
                {
                    // FIXME: that is very, very basic
                    alert("Server error: " + status + " (" + error + ")");
                });

                // Always executed
                request.always(function ()
                {
                    // Unlock inputs
                    $inputs.prop("disabled", false);
                });

                // Prevent default post method
                event.preventDefault();

                // TODO: test if actually necessary
                return false;
            });
        };

        // Execute function when document is ready
        $(document).ready(f);

    </script>
</head>
<body>
<div id="top">
    <p>Enter your schema and data to validate on the right, then press the
        "Validate" button. Both must be valid JSON, as defined by <a
        href="http://tools.ietf.org/html/rfc4627">RFC 4627</a>.
    </p>

    <p>This webapp uses the <a
        href="https://github.com/fge/json-schema-validator">
        json-schema-validator Java library</a>. It is available on <a
        href="https://github.com/fge/json-schema-validator-demo">GitHub</a>.
        Contributions are welcome.
    </p>

    <p><b>NOTE:</b> the default schema format is draft v3. If you want to
        validate agaisnt draft v4, you <i>must</i> include this line in your
        schema:
    </p>
    <blockquote>
        "$schema": "http://json-schema.org/draft-04/schema#"
    </blockquote>
</div>
<form id="validate">
    <div id="left" class="content">
        <label for="schema">Schema:</label>
        <textarea name="schema" rows="20" cols="20" class="half"
            id="schema"></textarea>
        <div class="options">
            <p>Validation options:</p>
            <div>
                <input type="checkbox" name="useV4" id="useV4" value="true">
                <label for="useV4">Default to draft v4</label>
            </div>
            <div>
                <input type="checkbox" name="useId" id="useId" value="true">
                <label for="useId">Use "id" for addressing</label>
            </div>
        </div>
        <label for="data">Data:</label>
        <textarea name="data" rows="20" cols="20" class="half"
            id="data"></textarea>
        <input type="submit" value="Validate">
    </div>
</form>
<div id="right" class="content">
    <label for="results">Validation results</label>
    <textarea name="results" rows="20" cols="20"
        id="results" readonly="readonly"></textarea>
</div>
</body>
</html>
